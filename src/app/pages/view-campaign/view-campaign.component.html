<div class="m-3" *ngIf="campaignExists">

  <!-- CF info -->
  
  <div class="row" style="justify-content: center;">
    <div class="col col-sm-8 col-md-8 col-lg-6">
      <app-campaign-card [campaign]="campaign" [view]="true"></app-campaign-card>
    </div>
  </div>
      
  <!-- cards with actions: user (fund), donor (fund or refund), owner (getfunds, refund) -->

  <!-- fund (all but the owner while cf is active) -->

  <div class="row mt-5" style="justify-content: center;" *ngIf="!isOwner && !isClosed">
  
    <div class="col col-sm-8 col-md-8 col-lg-6">
      
      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title style="font-size:x-large;">Help this campaign!</mat-card-title>
        </mat-card-header>

        <mat-card-content>
          <form [formGroup]="form" (ngSubmit)="sendFunds()">

            <div class="row" style="align-items:center;">

              <div class="col-6 col-sm-4 col-md-4 col-lg-4">
                <mat-form-field class="fund-form-field full-width" appearance="outline" floatLabel="always">
                  <mat-label>Amount</mat-label>
                  <input matInput class="text-right-align" type="number" formControlName="amount" required>
                  <span matTextSuffix>&nbsp;&#42793;</span>
                </mat-form-field>
    
              </div>

              <div class="col-6 col-sm-4 col-md-4 col-lg-4">
                <button mat-flat-button color="accent" type="submit" [disabled]="!form.valid">Send</button>
              </div>

            </div>

          </form>
        </mat-card-content>
                
      </mat-card>
    </div>
  </div>


  <!-- closing (owner) -->
  <div class="row mt-5" style="justify-content: center;" *ngIf="isOwner && !isClosed">
  
    <div class="col col-sm-8 col-md-8 col-lg-6">
      
      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title style="font-size:x-large;" *ngIf="isGoalMet">Congrats, you reached your goal!</mat-card-title>
          <mat-card-title style="font-size:x-large;" *ngIf="!isGoalMet">You haven't reached your goal yet</mat-card-title>
        </mat-card-header>

        <mat-card-content>

            <p *ngIf="isGoalMet">Your campaign is still active, you can close it whenever 
              you're happy with the results. This will prevent users from further funding 
              this campaign. Make sure you want to do it
            </p>

            <p *ngIf="!isGoalMet">Your campaign is active but you can close it whenever 
              you're happy with the results. This will prevent users from further funding 
              this campaign - make sure you want to do it
            </p>

            <button mat-flat-button color="warn" (click)="closeCampaign()">Close campaign</button>

        </mat-card-content>
        
      </mat-card>
    </div>
  </div>


  <!-- donate card -->

  <div 
    class="row mt-5" 
    style="justify-content: center;"
    *ngIf="isOwner">

    <div class="col-12 col-sm-8 col-md-8 col-lg-6">

      <mat-card appearance="outlined">

        <mat-card-header>
          <mat-card-title style="font-size:x-large;">Consider supporting this platform!</mat-card-title>
        </mat-card-header>

        <mat-card-content>
          <p>If you can afford it, please consider making a donation through 
            our own crowdfunding campaign - just click <a [routerLink]="['../', supportUsContract]">here</a>
          </p>
        </mat-card-content>
          
      </mat-card>

    </div>
  </div>

  <!-- closed crowdfunding -->

  <div 
    class="row mt-5" 
    style="justify-content: center;"
    *ngIf="isClosed">

    <div class="col-12 col-sm-8 col-md-8 col-lg-6">

      <mat-card appearance="outlined">

        <mat-card-header>
          <mat-card-title style="font-size:x-large;">This campaign is closed</mat-card-title>
        </mat-card-header>

        <mat-card-content *ngIf="!isOwner">
          <p>You can no longer support this campaign</p>
        </mat-card-content>

      </mat-card>

    </div>
  </div>



  <!-- Donations list -->

  <div class="row mt-5" style="justify-content: center;">
    <div class="col-12 col-sm-8 col-md-8 col-lg-6">

      <div class="donations-list">
        <table mat-table [dataSource]="donationTable">

          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef> Date </th>
            <td mat-cell *matCellDef="let element"> {{ element.date | date:'mediumDate' }} </td>
          </ng-container>
      
          <ng-container matColumnDef="address">
            <th mat-header-cell *matHeaderCellDef> Address </th>
            <td mat-cell *matCellDef="let element">
              <a [routerLink]="['../../profile', element.fundingAddress.address]">
                {{ element.fundingAddress.name == '' ? (element.fundingAddress.address | shorten) : element.fundingAddress.name }}</a>
            </td>
          </ng-container>
      
          <ng-container matColumnDef="amount">
            <th mat-header-cell *matHeaderCellDef style="text-align: center;"> Amount </th>
            <td mat-cell *matCellDef="let element" style="text-align: center;"> {{element.amount}}&nbsp;&#42793;</td>
          </ng-container>
      
          <!-- <ng-container matColumnDef="fundAnyway">
            <th mat-header-cell *matHeaderCellDef matTooltip="Funded even if goal is not met" style="text-align: center;"> Fund anyway </th>
            <td mat-cell *matCellDef="let element" style="text-align: center;"> 
              <mat-checkbox class="example-margin" [disabled]="true" color="primary" [checked]="element.fundAnyway"></mat-checkbox>
            </td>
          </ng-container> -->
      
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      
        <mat-paginator 
          (page)="handlePageEvent($event)"
          [length]="numDonations"
          [pageSize]="pageSize"
          [pageSizeOptions]="pageSizeOptions"
          aria-label="Select page">
        </mat-paginator>
      </div>

    </div>
  </div>

</div>


<!-- CF doesn't exist -->

<div class="m-3" *ngIf="campaignExists == false">
  <div class="row" style="justify-content: center;">
    <div class="col col-sm-8 col-md-8 col-lg-6">
      <mat-card appearance="outlined" [ngClass]="{'h-100':!create}">
        <mat-title style="font-size:large; line-height: normal;">There's no campaign with address {{ contractAddress }}</mat-title>        
      </mat-card>
    </div>
  </div>
</div>

<div class="m-3" *ngIf="campaignExists == undefined">
  <div class="row" style="justify-content: center                                                                                                                       ;">
    <div class="col col-sm-8 col-md-8 col-lg-6">
      <mat-card appearance="outlined" [ngClass]="{'h-100':!create}">
        <mat-title style="font-size:large; line-height: normal;">Loading campaign...</mat-title>        
      </mat-card>
    </div>
  </div>
</div>

